package anylayout.extras;

import static fpeas.function.FunctionUtility.minus;
import static anylayout.extras.LayoutContextUtility.getParentSize;
import static anylayout.extras.ConstraintBuilder.preferredSize;
import static anylayout.extras.BorderLayoutEmulationUtility.parentSizeMinus;
import anylayout.Constraint;
import anylayout.LayoutContext;
import static anylayout.extras.ConstraintBuilder.buildConstraint;
import fpeas.function.Function;
import fpeas.function.FunctionUtility;
import static fpeas.function.FunctionUtility.constant;

import java.awt.Component;

/**
 * Some implementations of {@link Constraint} for common cases.
 */
public final class ConstraintUtility
{
	private static final Function<Integer, Function<LayoutContext, Integer>> intConstant=new Function<Integer, Function<LayoutContext, Integer>>()
	{
		public Function<LayoutContext, Integer> run(final Integer integer)
		{
			return FunctionUtility.constant(integer);
		}
	};

	/**
	 * Lays out a component <code>left</code> pixels from the left of the container and
	 * <code>top</code> pixels from the top of the container.
	 */
	public static Constraint topLeft(final Function<? super LayoutContext,Integer> top, final Function<? super LayoutContext,Integer> left)
	{
		return buildConstraint().setLeft(left).setTop(top).setWidth(preferredSize).setHeight(preferredSize);
	}

	/**
	 * Lays out a component <code>left</code> pixels from the left of the container and
	 * <code>farSide</code> pixels from the farSide of the container.
	 */
	public static Constraint bottomLeft(final Function<? super LayoutContext,Integer> bottom, final Function<? super LayoutContext,Integer> left)
	{
		return topLeft(parentSizeMinus(preferredSizePlus(bottom)),left);
	}

	private static Function<LayoutContext, Integer> preferredSizePlus(final Function<? super LayoutContext, Integer> function)
	{
		return new Function<LayoutContext,Integer>()
		{
			public Integer run(final LayoutContext layoutContext)
			{
				return layoutContext.getPreferredSize()+function.run(layoutContext);
			}
		};
	}

	/**
	 * Lays out a component in the centre of the container horizontally, and
	 * <code>farSide</code> pixels from the farSide of the container.
	 */
	public static Constraint bottomCentre(final Function<LayoutContext, Integer> bottom)
	{
		return buildPartOfCentreConstraint().setTop(bottomOf(bottom)).setWidth(preferredSize).setHeight(preferredSize);
	}

	private static ConstraintBuilderStage2 buildPartOfCentreConstraint()
	{
		return buildConstraint().setLeft(getLeftCoordinateAsIfCentre());
	}

	private static Function<LayoutContext, Integer> getLeftCoordinateAsIfCentre()
	{
		return new Function<LayoutContext, Integer>()
		{
			public Integer run(final LayoutContext context)
			{
				return (context.getParentSize()-context.getPreferredSize())/2;
			}
		};

	}

	/**
	 * Lays out a component in the centre of the container horizontally, and
	 * <code>top</code> pixels from the top of the container.
	 */
	public static Constraint topCentre(final int top)
	{
		return buildPartOfCentreConstraint().setTop(intConstant.run(top)).setWidth(preferredSize).setHeight(preferredSize);
	}

	/**
	 * Lays out a component <code>right</code> pixels from the right-hand border of the container, and
	 * <code>farSide</code> pixels from the farSide of the container.
	 */
	public static Constraint bottomRight(final Function<LayoutContext, Integer> bottom, final Function<LayoutContext, Integer> right)
	{
		return buildConstraint().setLeft(farSide(right)).setTop(farSide(bottom)).setWidth(preferredSize).setHeight(preferredSize);
	}

	private static Function<LayoutContext, Integer> bottomOf(final Function<LayoutContext, Integer> bottom)
	{
		return ConstraintUtility.farSide(bottom);
	}

	/**
	 * Lays out a component <code>right</code> pixels from the right-hand border of the container, and
	 * <code>top</code> pixels from the top of the container.
	 */
	public static Constraint topRight(final Function<? super LayoutContext,Integer> top, final Function<? super LayoutContext,Integer> right)
	{
		return buildConstraint().setLeft(new Function<LayoutContext, Integer>()
		{
			public Integer run(final LayoutContext context)
			{
				return context.getParentSize()-context.getPreferredSize()-right.run(context);
			}
		}).setTop(top).setWidth(preferredSize).setHeight(preferredSize);
	}

	/**
	 * Gets the leftmost/topmost edge of something against the right or bottom border.
	 */
	private static Function<LayoutContext, Integer> farSide(final Function<LayoutContext,Integer> padding)
	{
		return minus(minus(getParentSize,padding),LayoutContextUtility.getPreferredSize);
	}

	public static Function<Component,Constraint> typicalDefaultConstraint(final Runnable exceptionHandler)
	{
		return new Function<Component, Constraint>()
		{
			public Constraint run(final Component component)
			{
				exceptionHandler.run();

				final Function<LayoutContext, Integer> zero=constant(0);

				return buildConstraint().setLeft(zero).setTop(zero).setWidth(preferredSize).setHeight(preferredSize);
			}
		};
	}
}